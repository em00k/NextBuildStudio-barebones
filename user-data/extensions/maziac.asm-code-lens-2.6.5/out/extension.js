var ho=Object.create;var me=Object.defineProperty;var wo=Object.getOwnPropertyDescriptor;var vo=Object.getOwnPropertyNames;var Lo=Object.getPrototypeOf,Co=Object.prototype.hasOwnProperty;var Ro=(n,e)=>{for(var t in e)me(n,t,{get:e[t],enumerable:!0})},oo=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of vo(e))!Co.call(n,o)&&o!==t&&me(n,o,{get:()=>e[o],enumerable:!(s=wo(e,o))||s.enumerable});return n};var S=(n,e,t)=>(t=n!=null?ho(Lo(n)):{},oo(e||!n||!n.__esModule?me(t,"default",{value:n,enumerable:!0}):t,n)),Eo=n=>oo(me({},"__esModule",{value:!0}),n);var Io={};Ro(Io,{activate:()=>yo,deactivate:()=>Mo});module.exports=Eo(Io);var x=S(require("vscode"));var De=S(require("vscode"));var to=S(require("vscode")),P=class{static Init(e){this.extension=e.extension}static getConfiguration(e){let s=this.extension.packageJSON.name;return to.workspace.getConfiguration(s,e)}};var b=class n{static{this.configs=new Map}static init(){let e=P.getConfiguration();n.globalToggleCommentPrefix=e.comments.toggleLineCommentPrefix,n.globalEnablePushPopMatching=e.enablePushPopMatching,n.globalEnableCodeLenses=!1,n.globalEnableHovering=!1,n.globalEnableCompletions=!1,n.globalEnableGotoDefinition=!1,n.globalEnableFindAllReferences=!1,n.globalEnableRenaming=!1,n.globalEnableOutlineView=!1;let t=De.workspace.workspaceFolders??[];for(let s of t){let o=new n,r=s.uri.fsPath;o.wsFolderPath=r;let i=P.getConfiguration(s);o.labelsWithColons=!0,o.labelsWithoutColons=!0;let l=(i.labels?.colon||"").toLowerCase();l.startsWith("without ")?o.labelsWithColons=!1:l.startsWith("with ")&&(o.labelsWithoutColons=!1);let a=i.labels?.excludes||"";o.labelsExcludes=a.toLowerCase().split(";"),o.excludeFiles=i.excludeFiles,o.enableCodeLenses=i.enableCodeLenses,o.enableHovering=i.enableHovering,o.enableCompletions=i.enableCompletions,o.enableGotoDefinition=i.enableGotoDefinition,o.enableFindAllReferences=i.enableFindAllReferences,o.enableRenaming=i.enableRenaming,o.enableOutlineView=i.enableOutlineView,o.completionsRequiredLength=i.completionsRequiredLength||0,o.completionsRequiredLength<1&&(o.completionsRequiredLength=1),o.workspaceSymbolsRequiredLength=i.workspaceSymbolsRequiredLength,o.workspaceSymbolsRequiredLength<1&&(o.workspaceSymbolsRequiredLength=1),o.enableWorkspaceSymbols=i.enableWorkspaceSymbols,o.enableFolding=i.enableFolding,n.configs.set(r,o),n.globalEnableCodeLenses||=i.enableCodeLenses,n.globalEnableHovering||=o.enableHovering,n.globalEnableCompletions||=o.enableCompletions,n.globalEnableGotoDefinition||=o.enableGotoDefinition,n.globalEnableFindAllReferences||=o.enableFindAllReferences,n.globalEnableRenaming||=o.enableRenaming,n.globalEnableOutlineView||=o.enableOutlineView,n.globalEnableWorkspaceSymbols||=o.enableWorkspaceSymbols}}static getConfigForDoc(e){if(!e)return;let t=De.workspace.getWorkspaceFolder(e.uri);if(t)return n.configs.get(t.uri.fsPath)}};var ie=class extends RegExp{constructor(e,t){super(t),this.find=e}exec(e){return e.indexOf(this.find)<0?null:super.exec(e)}},I=class extends RegExp{constructor(e,t){super(t),this.simpleRegex=e}exec(e){return this.simpleRegex.exec(e)?super.exec(e):null}};var p=class n{static regexLabelWithAndWithoutColon(){return/(^@?)([a-z_][\w.]*):?/i}static regexLabelWithColon(e){return e==="asm-list-file"?new ie(":",/(^[^#]*\s@?)([a-z_][\w.]*):/i):/(^@?)([a-z_][\w.]*):/i}static regexLabelWithoutColon(){return/^(@?)([a-z_][\w.]*)(?:\s|$)/i}static regexLabel(e,t){return t==="asm-list-file"?n.regexLabelWithColon(t):e.labelsWithColons&&e.labelsWithoutColons?n.regexLabelWithAndWithoutColon():e.labelsWithoutColons?n.regexLabelWithoutColon():n.regexLabelWithColon(t)}static regexInclude(){return new I(/INCLUDE/i,/\s*INCLUDE\s+"(.*)"/i)}static regexModuleStruct(){return new I(/(MODULE|STRUCT)/i,/^.*\s(MODULE|STRUCT)\s+([\w.]+)/i)}static regexEndModuleStruct(){return new I(/(ENDMODULE|ENDS)/i,/^.*\s(ENDMODULE|ENDS)\b/i)}static calcStartIndex(e){let t=e.index;for(let s=1;s<e.length;s++)if(e[s]){let o=e[s].length;t+=o}return t}static regexLabelColonForWord(e,t){return t=="asm-list-file"?new I(new RegExp(e,"i"),new RegExp("^(.*?\\s)([[a-zA-Z_\\.][\\w\\.]*)?\\b"+e+":")):new RegExp("^()([a-zA-Z_\\.][\\w\\.]*)?\\b"+e+":")}static regexLabelWithoutColonForWord(e){return new RegExp("^()([a-zA-Z_\\.][\\w\\.]*)?\\b"+e+"\\b(?![:\\.])")}static regexesLabelForWord(e,t,s){let o=[];if(t.labelsWithColons){let r=n.regexLabelColonForWord(e,s);o.push(r)}if(t.labelsWithoutColons&&s=="asm-collection"){let r=n.regexLabelWithoutColonForWord(e);o.push(r)}return o}static regexModuleForWord(e){return new I(/module/i,new RegExp("^(.*\\s(module|MODULE)\\s+)"+e+"\\b"))}static regexMacroForWord(e){return new I(/macro/i,new RegExp("^(.*\\s(macro|MACRO)\\s+)"+e+"\\b"))}static regexAnyReferenceForWord(e){return new ie(e,new RegExp("^([^#]*)\\b"+e+"\\b"))}static regexPrepareFuzzy(e){return e.replace(/(.)/g,"\\w*$1")}};var T=S(require("vscode"));var le,Te,no,fe;function so(n){fe=new Set([";","//"]),n&&fe.add(n);let e=Array.from(fe),t=`("|'|/\\*|`+e.join("|")+")";le=new RegExp(t,"g");let s="^(.*?)("+e.join("|")+")(.*)";Te=new RegExp(s,"i");let o="("+e.join("|")+")";no=new RegExp(o,"i")}function Q(n){let e=!1,t=n.length;for(let s=0;s<t;s++){let o=n[s];if(e){let i=o.indexOf("*/");if(i>=0)o=" ".repeat(i+2)+o.substring(i+2),e=!1;else{n[s]="";continue}}le.lastIndex=0;let r;for(;r=le.exec(o);){let i=r.index,l=r[1];if(l==='"'||l==="'"){let a=o.indexOf(l,i+1);if(a>=0)o=o.substring(0,i)+" ".repeat(a-i+1)+o.substring(a+1),le.lastIndex=a+1;else{o=o.substring(0,i);break}}else if(l==="/*"){let a=o.indexOf("*/",i+2);if(a>=0)o=o.substring(0,i)+" ".repeat(a-i+2)+o.substring(a+2),le.lastIndex=a+2;else{o=o.substring(0,i),e=!0;break}}else if(fe.has(l)){o=o.substring(0,i);break}}n[s]=o}}function ro(n,e){if(n.length==0||e<0||e>=n.length)return[];let t=[],s=n[e];(no.test(s)||s.toLowerCase().indexOf("equ")>=0)&&t.unshift(s);let r=e-1;if(r>=0){let i=n[r],l=i.indexOf("*/");l<0&&(l=Number.MAX_SAFE_INTEGER);let a=Te.exec(i),c=Number.MAX_SAFE_INTEGER;if(a&&(c=a[1].length),l!=c)if(c<l)for(t.unshift(a[3]),r--;r>=0;){let d=n[r],g=Te.exec(d);if(!g)break;t.unshift(g[3]),r--}else{let d=i.substring(0,l);for(d=d.trimEnd(),d&&t.unshift(d),r--;r>=0;){let g=n[r],m=g.indexOf("/*");if(m>=0){let u=g.substring(m+2);u=u.trimEnd(),u&&t.unshift(u);break}t.unshift(g),r--}}}return t}function Ne(n){let e=p.regexModuleStruct(),t=p.regexEndModuleStruct(),s=[],o=n.length,r=[];for(let i=0;i<o;i++){let l=n[i],a=e.exec(l),c=t.exec(l);if(a)s.push(a[2]);else if(c)s.pop();else continue;let d=s.join(".");r.push({row:i,label:d})}return r}function J(n,e,t=/[\w.]/){let s=n.length,o;for(o=e;o<s;o++){let c=n.charAt(o);if(!t.exec(c))break}let r;for(r=e-1;r>=0;r--){let c=n.charAt(r);if(!/[\w.]/.exec(c))break}r++;let i=n.substring(r,o),l=n.substring(0,r),a=!1;return r>0&&(a=n.charAt(r-1)==="@"),{label:i,preString:l,atLabel:a}}function Oe(n,e,t,s){let o;for(;t>s;t--){let r=e[t];if(o=n.exec(r),o){let i=o[2],l=o[1]==="@";return{label:i,atLabel:l}}}return{label:"_",atLabel:!1}}function Po(n,e){return!n||n.length==0?e:n+"."+e}function Ge(n,e,t,s,o=/[\w.]/){let r=e.lines,i=r[t],{label:l,preString:a,atLabel:c}=J(i,s,o),d,g=-1;if(!c)for(let f of e.modStructInfos){if(f.row>=t)break;d=f.label,g=f.row}if(l.startsWith(".")){let f=Oe(n,r,t,g);l=f.label+l,f.atLabel&&(d=void 0)}let m=Po(d,l),u=a.length+l.length;return(a.length===0||i[u]===":")&&(l=m),{label:l,moduleLabel:m}}var io=S(require("path")),lo=require("assert"),ao=S(require("vscode"));var ae=class{constructor(e,t){this.cacheTime=e,this.func=t,this.nextTime=Date.now()}getData(){let e=Date.now();return e>=this.nextTime&&(this.cachedData=this.func(),this.nextTime=e+this.cacheTime),this.cachedData}};var be=class n{static{this.asmCollectionCache=new ae(1e4,()=>n._getGlobalIncludeForLanguageId("asm-collection"))}static{this.asmFileListCache=new ae(1e4,()=>n._getGlobalIncludeForLanguageId("asm-list-file"))}static getGlobalIncludeForLanguageId(e){if(e=="asm-collection")return n.asmCollectionCache.getData();if(e=="asm-list-file")return n.asmFileListCache.getData();(0,lo.strict)(!1,'languageId = "'+e+'" unknown.')}static _getGlobalIncludeForLanguageId(e){let s=P.extension.packageJSON.contributes.languages,o=[];for(let a of s)if(a.id==e){o.push(...a.extensions.map(c=>c.substring(1)));break}let r=ao.workspace.getConfiguration("files.associations"),i=Object.entries(r);for(let[a,c]of i)if(typeof c=="string"){let d=io.extname(a).substring(1);if(c==e)o.push(d);else{let g=o.indexOf(d);g>=0&&o.splice(g,1)}}return"**/*.{"+o.join(",")+"}"}};var je=class extends T.Location{constructor(e,t,s){super(e,t),this.fileMatch=s;let{label:o}=J(s.lineContents,s.start);this.symbol=o}};function Fo(n,e){let t=new Map;return n.forEach(o=>t.set(e(o),o)),Array.from(t.values())}async function uo(n){return new Promise((e,t)=>{let s=T.Uri.file(n);T.workspace.openTextDocument(s).then(o=>e(o),o=>t(o))})}async function co(n){try{let t=(await uo(n)).getText().split(`
`);return Q(t),t}catch(e){return console.log(e),[]}}async function X(n,e,t,s){let o=new Map;try{let i=be.getGlobalIncludeForLanguageId(t),a=(await T.workspace.findFiles(i,s)).filter(c=>c.fsPath.startsWith(e));for(let c of a){let d=c.fsPath,g=await uo(d),m=Ue(g,n);for(let u of m)u.filePath=d;o.set(d,m)}}catch(i){console.log("Error: ",i)}let r=[];for(let[i,l]of o)for(let a of l){let c=a.line,d=a.start,g=a.end,m=new T.Position(c,d),u=new T.Position(c,g),f=new je(T.Uri.file(i),new T.Range(m,u),a);r.push(f)}return r}async function q(n,e,t,s){let o=[];for(let r of n){let i=await X(r,e,t,s);o.push(...i)}return n.length>0&&(o=Fo(o,r=>{let i=r.fileMatch;return i.filePath+":"+i.line+":"+i.start})),o}function Ue(n,e){let t=[],s=n.getText().split(`
`);Q(s);let o=s.length;for(let r=0;r<o;r++){let i=s[r];e.lastIndex=0;do{let l=e.exec(i);if(!l)break;let a=p.calcStartIndex(l),c=l.index+l[0].length;t.push({filePath:void 0,line:r,start:a,end:c,lineContents:i,match:l})}while(e.global)}return t}function go(n){let e,t,s=n.indexOf(".");s<0?(e="",t=n):(e=n.substring(0,s+1),t=n.substring(s+1));let o=p.regexPrepareFuzzy(t)+"\\w*",r=e.replace(/(\.)/g,"\\.");return r+=o,new RegExp(r,"i")}async function D(n,e,t,s,o=!0,r=!0,i=/[\w.]/){let l=await co(t),a=Ne(l),d=Ge(n,{lines:l,modStructInfos:a},s.line,s.character,i),g,m;r||(g=go(d.label),m=go(d.moduleLabel));let u=[...e],f=new Map,h=u.length;for(;h--;){let w=u[h],y=w.uri.fsPath,E=w.range.start,v=f[y];if(!v){let O=await co(y),F=Ne(O);v={lines:O,modStructInfos:F},f[y]=v}if(o&&E.line===s.line&&y===t){u.splice(h,1);continue}let C=Ge(n,v,E.line,E.character,i);if(w.label=C.label,w.moduleLabel=C.moduleLabel,r){if(C.label===d.label||C.moduleLabel===d.moduleLabel||C.moduleLabel===d.label||C.label===d.moduleLabel)continue}else if(g.exec(C.label)||m.exec(C.moduleLabel)||g.exec(C.moduleLabel)||m.exec(C.label))continue;u.splice(h,1)}return u}function po(n,e){let t=p.regexModuleStruct(),s=p.regexEndModuleStruct(),o=[];for(let i=0;i<e;i++){let l=n[i],a=t.exec(l);if(a){o.push(a[2]);continue}s.exec(l)&&o.pop()}return o.join(".")}var xe=class{async provideReferences(e,t,s,o){let r=b.getConfigForDoc(e);if(!r?.enableFindAllReferences)return;let i=e.getWordRangeAtPosition(t);if(!i)return;let l=e.getText(i),a=p.regexAnyReferenceForWord(l),c=e.languageId,d=await X(a,r.wsFolderPath,c,r.excludeFiles),g=p.regexLabel(r,c);return await D(g,d,e.fileName,t,!1,!0,/\w/)}};var he=class{static regexStructForWord(e){return new I(/struct/i,new RegExp("^(.*?\\s+(struct|STRUCT)\\s+)"+e+"\\b"))}};var N=S(require("vscode"));var we=class{async provideDefinition(e,t,s){let o=b.getConfigForDoc(e);if(!o){await N.window.showWarningMessage("Document is in no workspace folder.");return}if(!o.enableGotoDefinition){await N.window.showWarningMessage("Goto definitions are disabled for this workspace folder.");return}let r=e.lineAt(t.line).text,i=p.regexInclude().exec(r);return i?this.getInclude(o,i[1]):this.search(o,e,t)}async getInclude(e,t){let s=new N.RelativePattern(e.wsFolderPath,"**/"+t),o=await N.workspace.findFiles(s,null),r=[],i=new N.Position(0,0),l=new N.Range(i,i);for(let a of o){let c=new N.Location(a,l);r.push(c)}return r}async search(e,t,s){let o=t.getWordRangeAtPosition(s);if(!o)return;let r=t.getText(o);if(e.labelsExcludes.includes(r))return;let i=t.languageId,l=p.regexesLabelForWord(r,e,i),a=p.regexModuleForWord(r);l.push(a);let c=p.regexMacroForWord(r);l.push(c);let d=he.regexStructForWord(r);l.push(d);let g=await q(l,e.wsFolderPath,t.languageId,e.excludeFiles),m=p.regexLabel(e,i);return await D(m,g,t.fileName,s,!1,!0,/\w/)}};var $=S(require("vscode"));var ve=class{async provideHover(e,t,s){let o=b.getConfigForDoc(e);if(!o?.enableHovering)return;let r=/\w/,i=e.lineAt(t.line).text,{label:l}=J(i,t.character,r);if(l.startsWith("."))return new $.Hover("");let a=e.languageId,c=e.getWordRangeAtPosition(t);if(!c)return;let d=e.getText(c),g=p.regexesLabelForWord(d,o,a),m=p.regexModuleForWord(d);g.push(m);let u=p.regexMacroForWord(d);g.push(u);let f=await q(g,o.wsFolderPath,a,o.excludeFiles),h=p.regexLabel(o,a),L=await D(h,f,e.fileName,t,!1,!0,r),w=new Array;for(let E of L){let v=E.moduleLabel;if(o.labelsExcludes.includes(v))continue;let C=E.range.start.line,O=E.uri.fsPath,M=(await $.workspace.openTextDocument(O)).getText().split(`
`),U=ro(M,C);U.length>0&&(w.length>0&&w.push(new $.MarkdownString("============")),w.push(...U.map(K=>new $.MarkdownString(K))))}return w.length==0?void 0:new $.Hover(w)}};var Y=S(require("vscode"));var He=class extends Y.CodeLens{constructor(e,t,s,o){super(s),this.config=e,this.document=t,this.symbol=o}},Le=class{async provideCodeLenses(e,t){let s=b.getConfigForDoc(e);if(!s?.enableCodeLenses)return;let o=e.languageId,r=[],i=p.regexLabel(s,o),l=Ue(e,i);for(let a of l){let c=a.line,d=a.match[1]?a.match[1].length:0,g=a.end,u=e.lineAt(c).text.substring(d,g);u.endsWith(":")&&(g--,u=u.substring(0,u.length-1));let f=u.trim();if(!s.labelsExcludes.includes(f.toLowerCase())){let h=new Y.Position(c,d),L=new Y.Position(c,g),w=new Y.Range(h,L),y=new He(s,e,w,f);r.push(y)}}return r}async resolveCodeLens(e,t){let s=e.symbol,o=p.regexAnyReferenceForWord(s),r=e.document,i=e.range.start,l=e.config,a=r.languageId,c=await X(o,l.wsFolderPath,a,l.excludeFiles),d=p.regexLabel(l,a),g=await D(d,c,r.fileName,i,!0,!0),m=g.length,u=m+" reference";return m!=1&&(u+="s"),e.command={title:u,command:"editor.action.showReferences",arguments:[r.uri,i,g]},e}};var ce=S(require("vscode"));var Ce=class{static regexAnyReferenceForWordGlobal(e){return new I(new RegExp("\\b"+e+"\\b"),new RegExp("(.*?)\\b"+e+"\\b","g"))}};var Re=class{async provideRenameEdits(e,t,s,o){let r=new ce.WorkspaceEdit,i=b.getConfigForDoc(e);if(!i)return await ce.window.showWarningMessage("Document is in no workspace folder."),r;if(!i.enableRenaming)return await ce.window.showWarningMessage("Renaming is disabled for this workspace folder."),r;let l=e.getWordRangeAtPosition(t);if(!l)return r;let a=e.getText(l),c=Ce.regexAnyReferenceForWordGlobal(a),d=e.languageId,g=await X(c,i.wsFolderPath,d,i.excludeFiles),m=p.regexLabel(i,d),u=await D(m,g,e.fileName,t,!1,!0,/\w/);for(let f of u)r.replace(f.uri,f.range,s);return r}};var W=S(require("vscode"));var Z=class{static regexModuleLabel(){return/\b(module\s+([a-z_][\w.]*)|endmodule.*)/i}static regexStructLabel(){return/\b(struct\s+([a-z_][\w.]*)|ends.*)/i}static regexConst(){return/\b(equ)\s+(.*)/i}static regexData(){return/\b(d[bcdghmsw]|def[bdghmsw])\b\s*(.*)/i}static regexMacro(e){if(e!=="asm-list-file")return/\b(macro)\s+(.*)/i}};var Ee=class{provideDocumentSymbols(e,t){let s=b.getConfigForDoc(e);if(!s?.enableOutlineView)return;let o=e.languageId,r=[],i=p.regexLabel(s,o),l=Z.regexModuleLabel(),a=Z.regexStructLabel(),c=["include",...s.labelsExcludes],d=Z.regexConst(),g=Z.regexData(),m=Z.regexMacro(o),u,f=new Array,h,L=new Array,w=e.getText().split(`
`);Q(w);let y=w.length;for(let E=0;E<y;E++){let v=w[E],C=i.exec(v);if(C){let F=C[0].trimEnd(),R=C[1]+C[2];if(!c.includes(R)){let M=new W.Range(E,0,E,Number.MAX_SAFE_INTEGER),U=M;if(u=new W.DocumentSymbol(R,"",W.SymbolKind.Function,M,U),f.push(u),R.startsWith("."))h?.push(u);else if(R.startsWith("@"))r.push(u);else{let B=L.length;B>0?L[B-1].children.push(u):r.push(u),h=u.children}let K=F.length;v=v.substring(K),v+=" "}}if(m){let F=m.exec(v);if(F){let R=F[2];R===""&&(R=" ");let M=new W.Range(E,0,E,Number.MAX_SAFE_INTEGER),U=new W.DocumentSymbol(R,"macro",W.SymbolKind.Interface,M,M);r.push(U);continue}}let O=l.exec(v);if(O||(O=a.exec(v)),O){let F=O[1].toLowerCase(),R=O[2];if(R){let M=new W.Range(E,0,E,Number.MAX_SAFE_INTEGER),U=F.startsWith("module")?W.SymbolKind.Module:W.SymbolKind.Struct,K=new W.DocumentSymbol(R,"",U,M,M),B=L.length;B>0?L[B-1].children.push(K):r.push(K),L.push(K)}(F=="endmodule"||F=="ends")&&(L.pop(),h=void 0),u=void 0,f.length=0;continue}if(v=v.trim(),u&&v){let F,R=d.exec(v);if(R?F=W.SymbolKind.Constant:(R=g.exec(v),R&&(F=W.SymbolKind.Field)),F!=null)for(let M of f)M.kind=F,M.detail=R[1]+" "+R[2].trimEnd();u=void 0,f.length=0;continue}}return r}};var k=S(require("vscode"));var V=class{static regexesEveryLabelForWord(e,t,s){let o=[];if(t.labelsWithColons){let r=this.regexEveryLabelColonForWord(e,s);o.push(r)}if(t.labelsWithoutColons&&s=="asm-collection"){let r=this.regexEveryLabelWithoutColonForWord(e);o.push(r)}return o}static regexEveryLabelWithoutColonForWord(e){return new RegExp("^(([^0-9 ][\\w\\.]*)?)\\b"+e+"[\\w\\.]*\\b(?![:\\w\\.])","i")}static regexEveryLabelColonForWord(e,t){return t==="asm-list-file"?new RegExp("^(.*)\\b"+e+"[\\w\\.]*:","i"):new RegExp("(^@?[\\w\\.]*|^.*\\s@?[\\w\\.]*)\\b"+e+"[\\w\\.]*:","i")}static regexEveryModuleForWord(e,t){return t=="asm-list-file"?new RegExp("^(.*?\\s+(MODULE)\\s+)"+e+"[\\w\\.]*","i"):new RegExp("^(\\s+(MODULE)\\s+)"+e+"[\\w\\.]*","i")}static regexEveryMacroForWord(e,t){return t=="asm-list-file"?new RegExp("^(.*?\\s+(MACRO)\\s+)"+e+"[\\w\\._]*","i"):new RegExp("^(\\s+(MACRO)\\s+)"+e+"[\\w\\._]*","i")}};var So=["a","b","c","d","e","h","l","af","bc","de","hl","ix","iy","sp","ixl","ixh","iyl","iyh","adc","add","and","bit","call","ccf","cp","cpd","cpdr","cpi","cpir","cpl","daa","dec","di","ei","djnz","ex","exx","halt","im","inc","in","ind","indr","ini","inir","jp","jr","ld","ldd","lddr","ldi","ldir","neg","nop","or","otdr","otir","out","outd","outi","pop","push","res","ret","reti","retn","rl","rla","rlc","rlca","rld","rr","rra","rrc","rrca","rrd","rst","sbc","scf","set","sla","slia","sll","swap","sra","srl","sub","xor","ldix","ldws","ldirx","lddx","lddrx","ldpirx","outinb","mul","swapnib","mirror","nextreg","pixeldn","pixelad","setae","test","bsla","bsra","bsrl","bsrf","brlc","sli","macro","endm","module","endmodule","struct","ends","dup","edup","if","ifn","ifdef","ifndef","ifused","ifnused","else","endif","include","incbin","abyte","abytec","abytez","align","assert","binary","block","defb","defd","defg","defh","defl","defm","defs","defw","dephase","disp","phase","unphase","d24","db","dc","dd","dg","dh","hex","dm","ds","dw","dz","display","byte","word","dword","emptytap","emptytrd","encoding","equ","export","end","endlua","endt","ent","includelua","inchob","inctrd","insert","lua","labelslist","org","outend","output","memorymap","mmu","page","rept","endr","savebin","savedev","savehob","savesna","savetrd","savetap","basic","code","numbers","chars","headless","savenex","core","cfg","cfg3","bar","palette","default","mem","bmp","screen","l2","l2_320","l2_640","scr","shc","shr","tile","cooper","bank","auto","shellexec","size","slot","tapend","tapout","textarea","define","undefine","defarray","defarray+","device","ZXSPECTRUM48","ZXSPECTRUM128","ZXSPECTRUM256","ZXSPECTRUM512","ZXSPECTRUM1024","ZXSPECTRUM2048","ZXSPECTRUM4096","ZXSPECTRUM8192","ZXSPECTRUMNEXT","NONE","ramtop","open","close","setbp","setbreakpoint","bplist","unreal","zesarux","opt","cspectmap","fpos","_sjasmplus","_version","_release","_errors","_warnings"],Pe=class{async provideCompletionItems(e,t,s,o){let r=b.getConfigForDoc(e);if(!r?.enableCompletions)return;let i=r.completionsRequiredLength,l=e.lineAt(t).text,a=J(l,t.character),c=a.label.length;if(a.label.startsWith(".")&&c--,c<i)return new k.CompletionList([new k.CompletionItem(" ")],!1);let d=e.getText().split(`
`),g=t.line,m=po(d,g),u=d[g],f=J(u,t.character),h=f.preString.length,L=h+f.label.length,w=new k.Range(new k.Position(g,h),new k.Position(g,L)),y=e.languageId,E=p.regexLabel(r,y),v;f.label.startsWith(".")&&(v=Oe(E,d,g,-1).label);let C=e.getWordRangeAtPosition(t);if(!C)return;let O=e.getText(C),F=p.regexPrepareFuzzy(O),R=V.regexesEveryLabelForWord(F,r,y),M=V.regexEveryModuleForWord(F,y);R.push(M);let U=V.regexEveryMacroForWord(F,y);R.push(U);let K=await q(R,r.wsFolderPath,y,r.excludeFiles),B=await D(E,K,e.fileName,t,!0,!1),ge=new Map;for(let pe of B){let H=pe.moduleLabel;if(r.labelsExcludes.includes(H))continue;let A=new k.CompletionItem(H,k.CompletionItemKind.Function);if(A.filterText=H,A.range=w,v){A.filterText=f.label;let j=m.length;j>0&&j++,j+=v.length;let te=H.substring(j);A.insertText=te,A.label=te,A.filterText=te}else if(H.startsWith(m+".")){let j=m.length+1,te=H.substring(j);A.insertText=te,A.label="["+H.substring(0,j)+"] "+te}ge.set(A.label,A)}let eo=Array.from(ge.values()),ue;if(f.label.lastIndexOf(".")<0){let pe=f.label[0]===f.label[0].toUpperCase(),H=0;ue=So.map(A=>{pe&&(A=A.toUpperCase());let j=new k.CompletionItem(A,k.CompletionItemKind.Function);return j.sortText=H.toString(),H++,j.range=w,j}),ue.push(...eo)}else ue=eo;return new k.CompletionList(ue,!1)}};var mo=S(require("path")),ye=S(require("vscode"));var Fe=class{static regexLabelEquOrMacro(){return new I(/(equ|macro)/i,/^.*[a-z_][\w.]*[:\s]\s*(equ|macro)/i)}};var ee=ye.window.createOutputChannel("ASM Code Lens"),Se=class{static async findLabelsWithNoReference(e,t){let s=p.regexLabel(e,t),o=await q([s],e.wsFolderPath,t,e.excludeFiles);await this.findLabels(o,e,t)}static async findLabels(e,t,s){let o=mo.basename(t.wsFolderPath),r=s=="asm-list-file"?"list":"asm";ee.appendLine("Unreferenced labels for "+r+" files, "+o+":"),ee.show(!0);try{let i=e.length,l=0,a=Fe.regexLabelEquOrMacro(),c=p.regexLabel(t,s);for(let d of e){let g=d.fileMatch;if(a.lastIndex=g.match[1].length,a.exec(g.lineContents)){i--,i==0&&ee.appendLine("Done. "+l+" unreferenced label"+(l>1?"s":"")+".");continue}let u=g.match[2],f=u.replace(/\./,"\\."),h=new ye.Position(g.line,g.start),L=g.filePath,w=p.regexAnyReferenceForWord(f),y=await X(w,t.wsFolderPath,s,t.excludeFiles);if((await D(c,y,L,h,!0,!0)).length==0&&(l++,ee.appendLine(u+", "+L+":"+(h.line+1))),i--,i==0){let C=l+" unreferenced label";ee.appendLine("Done. "+C+(l>1?"s":"")+".")}}}catch(i){console.log("Error: ",i)}e.length==0&&ee.appendLine("None."),ee.appendLine("")}};var fo=S(require("vscode")),bo=S(require("path")),xo=require("fs");var de=class{resolveWebviewView(e,t,s){this.webview=e.webview,this.webview.options={enableScripts:!0},this.setMainHtml()}setMainHtml(){if(!this.webview)return;let e=P.extension.extensionPath,t=bo.join(e,"html","hexcalc.html"),s=(0,xo.readFileSync)(t).toString(),o=fo.Uri.file(e),r=this.webview.asWebviewUri(o).toString();s=s.replace(/\${vscodeResPath}/g,r);let l=P.getConfiguration().get("hexCalculator.hexPrefix");s=s.replace("//${init}",`
let hexPrefix = "${l}";`),this.webview.html=s}};var se=S(require("vscode")),qe=S(require("path")),Ve=require("fs");var Me=class{static isNewVersion(e,t){try{if(!e)return!1;let s=e.split(".");if(s.length<2)return!1;if(!t)return!0;let o=t.split(".");if(o.length<2)return!0;let r=parseInt(s[0]);if(isNaN(r))return!1;let i=parseInt(s[1]);if(isNaN(i))return!1;let l=parseInt(o[0]);if(isNaN(l))return!0;let a=parseInt(o[1]);return!!(isNaN(a)||r>l||i>a)}catch{return!1}}};var oe=class{static Init(e){this.context=e}static Get(e){return this.context.globalState.get(e)}static Set(e,t){(async()=>await this.context.globalState.update(e,t))()}};var ne=class{static updateVersion(){let e="version",t=oe.Get(e),s=P.extension.packageJSON.version;return s!==t&&oe.Set(e,s),t?Me.isNewVersion(s,t):!1}constructor(){this.vscodePanel=se.window.createWebviewPanel("","",{preserveFocus:!0,viewColumn:se.ViewColumn.Nine}),this.vscodePanel.title="Whats New",this.setHtml()}setHtml(){if(!this.vscodePanel.webview)return;let e=P.extension.extensionPath,t=qe.join(e,"html/whatsnew.html"),s=(0,Ve.readFileSync)(t).toString(),o=se.Uri.file(e),r=this.vscodePanel.webview.asWebviewUri(o).toString();s=s.replace("${vscodeResPath}",r),s=s.replace(/\${extensionName}/g,P.extension.packageJSON.id);let i=P.extension.packageJSON.version.split("."),l=i.shift()||"",a=i.shift();a&&(l+="."+a),s=s.replace(/\${extensionMainVersion}/g,l),s=s.replace(/\${extensionDisplayName}/g,P.extension.packageJSON.displayName),s=s.replace(/\${repositoryUrl}/g,P.extension.packageJSON.repository.url),s=s.replace(/\${repositoryIssues}/g,P.extension.packageJSON.bugs.url),s=s.replace(/\${repositoryHomepage}/g,P.extension.packageJSON.repository.url);let c=qe.join(e,"html/whatsnew_changelog.html"),d=(0,Ve.readFileSync)(c).toString();s=s.replace("${changeLog}",d),this.vscodePanel.webview.html=s}};var re=S(require("vscode"));var Ie=class{provideWorkspaceSymbols(e,t){return new Promise(s=>{(async()=>{let o=[],r=re.workspace.workspaceFolders;if(r){let i=e.length;for(let l of r){if(t.isCancellationRequested){s(void 0);return}let a=b.configs.get(l.uri.fsPath);if(!a?.enableWorkspaceSymbols)continue;let c=a.workspaceSymbolsRequiredLength;if(i<c)continue;let d=await this.getWsSymbols(a,e);o.push(...d)}}s(o)})()})}async getWsSymbols(e,t){let s="asm-collection",o=p.regexPrepareFuzzy(t),r=V.regexesEveryLabelForWord(o,e,s),i=V.regexEveryModuleForWord(o,s);r.push(i);let l=V.regexEveryMacroForWord(o,s);r.push(l);let a=await q(r,e.wsFolderPath,s,e.excludeFiles),c=[];for(let d of a){let g=d.symbol;if(e.labelsExcludes.includes(g))continue;let m=new re.Location(d.uri,d.range),u=new re.SymbolInformation(g,void 0,"",m);c.push(u)}return c}};var z=S(require("vscode"));var G=class{static regexCommentSingleLine(e){let t=new Set([";","//"]);e&&t.add(e);let o="^("+Array.from(t).join("|")+")";return new RegExp(o)}static regexCommentMultipleStart(){return/^\/\*/}static regexCommentMultipleEnd(){return/\*\//}static regexModuleStart(){return/\s+module\b/i}static regexModuleEnd(){return/\s+endmodule\b/i}static regexStructStart(){return/\s+struct\b/i}static regexStructEnd(){return/\s+ends\b/i}static regexMacroStart(){return/\s+macro\b/i}static regexMacroEnd(){return/\s+endm\b/i}};var We=class{provideFoldingRanges(e,t,s){let o=b.getConfigForDoc(e);if(!o?.enableFolding)return[];let i=e.getText().split(`
`),l=[],a=p.regexLabel(o,"asm-collection"),c=G.regexCommentMultipleStart(),d=G.regexCommentMultipleEnd(),g=G.regexCommentSingleLine(b.globalToggleCommentPrefix),m=-1,u,f=i.length;for(let h=0;h<f;h++){let L=i[h];switch(u){case"/*":d.exec(L)&&(this.addRange(l,m,h,z.FoldingRangeKind.Comment),u=void 0);break;case";":g.exec(L)||(h--,this.addRange(l,m,h,z.FoldingRangeKind.Comment),u=void 0);break;case"label":default:{let w;a.exec(L)?w="label":g.exec(L)?w=";":c.exec(L)&&(w="/*"),w&&(u==="label"&&this.addRange(l,m,h-1,z.FoldingRangeKind.Region),m=h,u=w);break}}}if(u){let h=u==="label"?z.FoldingRangeKind.Region:z.FoldingRangeKind.Comment;this.addRange(l,m,f-1,h)}return Q(i),this.addRangesForRegex(i,l,G.regexModuleStart(),G.regexModuleEnd()),this.addRangesForRegex(i,l,G.regexStructStart(),G.regexStructEnd()),this.addRangesForRegex(i,l,G.regexMacroStart(),G.regexMacroEnd()),l}addRange(e,t,s,o){if(s>t){let r=new z.FoldingRange(t,s,o);e.push(r)}}addRangesForRegex(e,t,s,o){let r=[],i=-1,l=e.length-1;for(let a of e)if(i++,s.exec(a)){let c=new z.FoldingRange(i,l,z.FoldingRangeKind.Region);r.push(c),t.push(c)}else if(o.exec(a)){let c=r.pop();c&&(c.end=i)}}};function yo(n){if(new Date>new Date("2025-12-04")){let o="ASM Code Lens is outdated and has been deactivated. Features such as code lenses, completion, hovering, and navigation are unavailable. However, syntax highlighting may still work. Please upgrade 'asm-code-lens' to the latest version.";x.window.showErrorMessage(o,{modal:!1});let r=x.languages.createDiagnosticCollection("asm-code-lens");x.workspace.textDocuments.forEach(i=>{if(i.languageId==="asm-collection"||i.languageId==="asm-list-file"){let l=new x.Diagnostic(new x.Range(0,0,0,1),o,x.DiagnosticSeverity.Error);r.set(i.uri,[l])}}),n.subscriptions.push(r);return}P.Init(n),oe.Init(n),ne.updateVersion()&&new ne,n.subscriptions.push(x.commands.registerCommand("asm-code-lens.whatsNew",()=>new ne)),ke=new de,n.subscriptions.push(x.window.registerWebviewViewProvider("asm-code-lens.calcview-explorer",ke,{webviewOptions:{retainContextWhenHidden:!0}})),Ae=new de,n.subscriptions.push(x.window.registerWebviewViewProvider("asm-code-lens.calcview-debug",Ae,{webviewOptions:{retainContextWhenHidden:!0}})),ze(n),n.subscriptions.push(x.workspace.onDidChangeConfiguration(o=>{ze(n,o)})),n.subscriptions.push(x.workspace.onDidChangeWorkspaceFolders(o=>{ze(n)})),x.commands.registerCommand("asm-code-lens.find-labels-with-no-reference",async()=>{let r=x.window.activeTextEditor?.document;if(!r)return;let i=r.languageId;if(i!="asm-collection"&&i!="asm-list-file")return;let l=b.getConfigForDoc(r);l&&await Se.findLabelsWithNoReference(l,i)})}function ze(n,e){e&&e.affectsConfiguration("asm-code-lens.hexCalculator.hexPrefix")&&(ke&&ke.setMainHtml(),Ae&&Ae.setMainHtml()),_(Ke,n),_(Xe,n),_(_e,n),_(Je,n),_($e,n),_(Ze,n),_(Be,n),_(Qe,n),_(Ye,n),b.init();let t=[{scheme:"file",language:"asm-collection"},{scheme:"file",language:"asm-list-file"}];if(b.globalEnableCodeLenses){let o=new Le;Ke=x.languages.registerCodeLensProvider(t,o),n.subscriptions.push(Ke)}b.globalEnableHovering&&(Xe=x.languages.registerHoverProvider(t,new ve),n.subscriptions.push(Xe)),b.globalEnableCompletions&&(_e=x.languages.registerCompletionItemProvider(t,new Pe),n.subscriptions.push(_e)),b.globalEnableGotoDefinition&&(Je=x.languages.registerDefinitionProvider(t,new we),n.subscriptions.push(Je)),b.globalEnableFindAllReferences&&($e=x.languages.registerReferenceProvider(t,new xe),n.subscriptions.push($e)),b.globalEnableRenaming&&(Ze=x.languages.registerRenameProvider(t,new Re),n.subscriptions.push(Ze)),b.globalEnableOutlineView&&(Be=x.languages.registerDocumentSymbolProvider(t,new Ee),n.subscriptions.push(Be)),b.globalEnableWorkspaceSymbols&&(Qe=x.languages.registerWorkspaceSymbolProvider(new Ie),n.subscriptions.push(Qe)),Ye=x.languages.registerFoldingRangeProvider({scheme:"file",language:"asm-collection"},new We),n.subscriptions.push(Ye),x.languages.setLanguageConfiguration("asm-collection",{comments:{lineComment:b.globalToggleCommentPrefix,blockComment:["/*","*/"]}}),so(b.globalToggleCommentPrefix);let s=[["{","}"],["[","]"],["(",")"]];b.globalEnablePushPopMatching&&s.push(["push","pop"]),x.languages.setLanguageConfiguration("asm-collection",{brackets:s})}function _(n,e){if(n){n.dispose();let t=e.subscriptions.indexOf(n);e.subscriptions.splice(t,1)}}var ke,Ae,Ke,Xe,_e,Je,$e,Ze,Be,Qe,Ye;function Mo(){}0&&(module.exports={activate,deactivate});
